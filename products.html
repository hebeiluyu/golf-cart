<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>产品 | Luyu Electric Vehicles</title>
  <meta name="description" content="电动高尔夫球车、电动迷你巴士、公用车辆UTV。支持OEM/CKD，出口经验丰富，工厂直供，支持定制与快速报价。" />
  <link rel="canonical" href="https://luyuevcart.com/products.html" />

  <style>
    :root{
      --bg:#f6fbf7;
      --card:#ffffff;
      --line:#e4efe7;
      --text:#0f1f15;
      --muted:#4a6155;
      --green:#1bb36b;
      --green2:#11a35f;
      --greenSoft:#e9f7ef;
      --shadow: 0 10px 30px rgba(12, 34, 22, .08);
      --radius:18px;
      --radius2:14px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "PingFang SC","Microsoft Yahei", sans-serif;
      background: linear-gradient(180deg, #eef9f1 0%, var(--bg) 40%, #ffffff 100%);
      color:var(--text);
    }

    /* ✅ 关键：弹窗打开时锁定背景滚动 */
    body.modal-open{ overflow:hidden; }

    a{ color:inherit; text-decoration:none; }
    .container{ width:min(1160px, 92vw); margin:0 auto; }

    /* Header (跟你现在首页风格一致：浅色+绿点缀) */
    .topbar{
      position:sticky; top:0; z-index:20;
      background: rgba(255,255,255,.78);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .nav{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 0;
      gap:14px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800;
      letter-spacing:.2px;
    }
    .logo{
      width:34px; height:34px; border-radius:10px;
      background: radial-gradient(circle at 30% 30%, #baf2d5 0%, #54d89f 45%, #1bb36b 100%);
      border:1px solid #bfe8d2;
      box-shadow: 0 8px 18px rgba(27,179,107,.18);
      display:grid; place-items:center;
      color:#0b3a24; font-weight:900;
    }
    .menu{
      display:flex; gap:22px; align-items:center;
      font-weight:600; color:var(--muted);
    }
    .menu a{ padding:8px 10px; border-radius:10px; }
    .menu a:hover{ background: var(--greenSoft); color:#0d2b1c; }

    .cta{
      display:flex; gap:10px; align-items:center;
    }
    .btn{
      border:1px solid var(--line);
      background:#fff;
      padding:10px 14px;
      border-radius:12px;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 6px 16px rgba(0,0,0,.05);
      transition:.18s transform, .18s box-shadow, .18s background;
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 10px 20px rgba(0,0,0,.08); }
    .btn.primary{
      background: linear-gradient(180deg, #22c978 0%, var(--green2) 100%);
      border:0; color:#fff;
    }

    /* Page head */
    .hero{
      padding:26px 0 12px;
    }
    .hero h1{
      margin:0 0 8px;
      font-size: clamp(24px, 3.2vw, 34px);
      letter-spacing:.2px;
    }
    .hero p{
      margin:0;
      color:var(--muted);
      line-height:1.6;
    }

    /* Top category tabs */
    .tabs{
      margin:18px 0 18px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .tab{
      padding:10px 14px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      font-weight:800;
      color:#1b3a2a;
      cursor:pointer;
      transition:.18s transform,.18s background,.18s box-shadow;
      box-shadow: 0 8px 18px rgba(0,0,0,.05);
    }
    .tab:hover{ transform: translateY(-1px); background: var(--greenSoft); }
    .tab.active{
      background: linear-gradient(180deg,#24cc7a 0%, #14a762 100%);
      color:#fff;
      border-color: transparent;
    }

    /* Sections */
    section{
      scroll-margin-top:90px;
      padding:18px 0 8px;
    }
    .sectionHead{
      display:flex; align-items:flex-end; justify-content:space-between; gap:14px;
      margin:8px 0 14px;
    }
    .sectionHead h2{ margin:0; font-size:22px; }
    .sectionHead small{ color:var(--muted); }

    /* Cards grid */
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:14px;
      margin-bottom:16px;
    }
    .card{
      grid-column: span 6;
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      transition:.18s transform, .18s box-shadow;
      position:relative;
    }
    .card:hover{ transform: translateY(-2px); box-shadow: 0 16px 38px rgba(12,34,22,.12); }
    .cardMedia{
      height:160px;
      background:
        linear-gradient(120deg, rgba(27,179,107,.18), rgba(255,255,255,.0)),
        linear-gradient(180deg, #eaf7ef, #ffffff);
      display:flex; align-items:center; justify-content:center;
      color:#2b5a41;
      font-weight:800;
    }
    .cardBody{ padding:14px; }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      background: var(--greenSoft);
      color:#0d3a24;
      border:1px solid #cfeedd;
      padding:7px 10px;
      border-radius:999px;
      font-weight:800;
      font-size:13px;
    }
    .dot{
      width:9px;height:9px;border-radius:50%;
      background: var(--green);
      box-shadow: 0 0 0 4px rgba(27,179,107,.18);
    }
    .cardTitle{
      margin:10px 0 6px;
      font-size:18px;
      font-weight:900;
    }
    .cardDesc{
      margin:0 0 12px;
      color:var(--muted);
      line-height:1.55;
      min-height:46px;
    }
    .cardActions{
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .btn.small{ padding:9px 12px; border-radius:12px; font-weight:900; }

    /* UTV gallery */
    .utvGrid .card{ grid-column: span 4; }
    .utvGrid .cardMedia{ height:140px; }

    /* Footer */
    .footer{
      margin-top:22px;
      padding:18px 0 28px;
      border-top:1px solid var(--line);
      color:var(--muted);
      font-size:14px;
    }

    /* ---------------- Modal ---------------- */
    .modalOverlay{
      position:fixed; inset:0;
      background: rgba(10, 22, 15, .42);
      display:none;
      z-index:100;
      padding:18px;
    }
    .modalOverlay.open{ display:flex; align-items:center; justify-content:center; }
    .modal{
      width:min(1100px, 96vw);
      max-height: min(84vh, 760px);
      background: #f7fbf8;
      border:1px solid rgba(255,255,255,.55);
      border-radius: 22px;
      box-shadow: 0 30px 80px rgba(0,0,0,.25);
      overflow:hidden;
      display:grid;
      grid-template-columns: 360px 1fr;
    }
    .modalLeft{
      background: #ffffff;
      border-right:1px solid var(--line);
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .modalTitleRow{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .modalTitle{
      font-weight:1000;
      font-size:18px;
      margin:0;
    }
    .closeBtn{
      border:1px solid var(--line);
      background:#fff;
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:900;
    }
    .panel{
      background: var(--greenSoft);
      border:1px solid #cfeedd;
      border-radius:16px;
      padding:12px;
    }
    .panel h4{
      margin:0 0 6px;
      font-size:13px;
      color:#0f3b25;
    }
    .panel .big{
      font-size:26px;
      font-weight:1000;
      color:#0e2a1c;
    }
    .muted{ color:var(--muted); font-size:13px; line-height:1.45; }

    /* ✅ 右侧滚动区域：必须 overflow auto */
    .modalRight{
      padding:16px;
      overflow:auto;
      background: linear-gradient(180deg, #f6fbf7 0%, #ffffff 55%);
    }

    .group{
      margin-bottom:14px;
      background:#fff;
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
    }
    .groupHead{
      padding:12px 12px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      background: #f3faf6;
      border-bottom:1px solid var(--line);
    }
    .groupHead strong{ font-size:14px; }
    .hint{ font-size:12px; color:var(--muted); }
    .options{
      padding:10px 12px 12px;
      display:flex; flex-direction:column; gap:10px;
    }
    .opt{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      background:#fff;
      transition:.18s transform,.18s box-shadow;
    }
    .opt:hover{ transform: translateY(-1px); box-shadow: 0 10px 18px rgba(0,0,0,.06); }
    .optLeft{ display:flex; gap:12px; align-items:center; }
    .imgPh{
      width:46px; height:46px; border-radius:14px;
      background: linear-gradient(135deg,#e9f7ef,#ffffff);
      border:1px solid var(--line);
      display:grid; place-items:center;
      font-weight:900; color:#2a5a40;
    }
    .optText{ display:flex; flex-direction:column; gap:2px; }
    .optText b{ font-size:14px; }
    .optText span{ font-size:12px; color:var(--muted); }
    .optRight{
      display:flex; align-items:center; gap:12px;
      min-width:140px;
      justify-content:flex-end;
    }
    .priceTag{ font-weight:1000; color:#0e2a1c; }
    .radio{
      width:18px; height:18px; border-radius:50%;
      border:2px solid #b8d9c7;
      display:inline-block;
      position:relative;
      flex:0 0 auto;
    }
    .radio.on{ border-color: var(--green); }
    .radio.on:after{
      content:"";
      position:absolute; inset:3px;
      background: var(--green);
      border-radius:50%;
    }

    /* bottom bar inside modal */
    .modalBottom{
      position:sticky;
      bottom:0;
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(8px);
      border-top:1px solid var(--line);
      padding:12px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      border-radius: 0 0 16px 16px;
      margin-top:14px;
    }
    .totalLine{
      font-weight:1000;
      color:#0e2a1c;
    }
    .bottomBtns{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }

    /* Responsive */
    @media (max-width: 920px){
      .card{ grid-column: span 12; }
      .utvGrid .card{ grid-column: span 12; }
      .modal{ grid-template-columns: 1fr; }
      .modalLeft{ border-right:0; border-bottom:1px solid var(--line); }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <div class="topbar">
    <div class="container">
      <div class="nav">
        <a class="brand" href="index.html">
          <div class="logo">LV</div>
          <div>Luyu Electric Vehicles</div>
        </a>

        <div class="menu">
          <a href="index.html">Home</a>
          <a href="products.html" style="color:#0f1f15;font-weight:900;">Products</a>
          <a href="oem.html">OEM &amp; Custom</a>
          <a href="about.html">About Us</a>
          <a href="contact.html">Contact</a>
        </div>

        <div class="cta">
          <a class="btn primary" target="_blank" rel="noopener"
             href="https://wa.me/8613292812529?text=Hello%20Luyu%2C%20I%20would%20like%20a%20quote%20for%20EV%20carts.">
            WhatsApp
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Page -->
  <div class="container">
    <div class="hero">
      <h1>产品中心 / Products</h1>
      <p>电动高尔夫球车、电动迷你巴士、公用车辆（UTV）。支持 OEM/CKD，工厂直供与出口服务。</p>
    </div>

    <!-- Tabs -->
    <div class="tabs" id="tabs">
      <button class="tab active" data-target="golf">电动高尔夫球车</button>
      <button class="tab" data-target="bus">电动迷你巴士</button>
      <button class="tab" data-target="utv">公用车辆（UTV）</button>
    </div>

    <!-- Golf -->
    <section id="golf">
      <div class="sectionHead">
        <h2>电动高尔夫球车</h2>
        <small>套餐卡片 → 点击“详情/订单”弹窗配置并自动计算（参考）</small>
      </div>

      <div class="grid">
        <div class="card">
          <div class="cardMedia">（占位图）A 套餐：不同前脸 / 颜色</div>
          <div class="cardBody">
            <span class="badge"><span class="dot"></span> 电动高尔夫球车 - A 套餐</span>
            <div class="cardTitle">EV Golf Cart - Package A</div>
            <p class="cardDesc">适用于球场/度假村/社区。支持 OEM/CKD，快速装柜与出口文件。</p>
            <div class="cardActions">
              <button class="btn small primary" onclick="openModal('golf','A')">详情 / 订单</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardMedia">（占位图）B 套餐：不同前脸 / 颜色</div>
          <div class="cardBody">
            <span class="badge"><span class="dot"></span> 电动高尔夫球车 - B 套餐</span>
            <div class="cardTitle">EV Golf Cart - Package B</div>
            <p class="cardDesc">主推款：高性价比配置，适合批量采购与定制升级。</p>
            <div class="cardActions">
              <button class="btn small primary" onclick="openModal('golf','B')">详情 / 订单</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardMedia">（占位图）C 套餐：不同前脸 / 颜色</div>
          <div class="cardBody">
            <span class="badge"><span class="dot"></span> 电动高尔夫球车 - C 套餐</span>
            <div class="cardTitle">EV Golf Cart - Package C</div>
            <p class="cardDesc">偏豪华配置：外观/内饰/多媒体升级空间更大。</p>
            <div class="cardActions">
              <button class="btn small primary" onclick="openModal('golf','C')">详情 / 订单</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardMedia">（占位图）D 套餐：不同前脸 / 颜色</div>
          <div class="cardBody">
            <span class="badge"><span class="dot"></span> 电动高尔夫球车 - D 套餐</span>
            <div class="cardTitle">EV Golf Cart - Package D</div>
            <p class="cardDesc">更强动力/越野轮胎等可选，适合景区/复杂路况。</p>
            <div class="cardActions">
              <button class="btn small primary" onclick="openModal('golf','D')">详情 / 订单</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Mini bus -->
    <section id="bus">
      <div class="sectionHead">
        <h2>电动迷你巴士</h2>
        <small>套餐 A / B → 弹窗选择座位数、动力、车身形式等</small>
      </div>

      <div class="grid">
        <div class="card">
          <div class="cardMedia">（占位图）Mini Bus A：不同前脸</div>
          <div class="cardBody">
            <span class="badge"><span class="dot"></span> 电动迷你巴士 - A 套餐</span>
            <div class="cardTitle">Electric Mini Bus - Package A</div>
            <p class="cardDesc">酒店/园区/接驳。支持多座位版本与出口定制。</p>
            <div class="cardActions">
              <button class="btn small primary" onclick="openModal('bus','A')">详情 / 订单</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardMedia">（占位图）Mini Bus B：不同前脸</div>
          <div class="cardBody">
            <span class="badge"><span class="dot"></span> 电动迷你巴士 - B 套餐</span>
            <div class="cardTitle">Electric Mini Bus - Package B</div>
            <p class="cardDesc">更丰富配置组合：封闭/敞篷、动力升级等。</p>
            <div class="cardActions">
              <button class="btn small primary" onclick="openModal('bus','B')">详情 / 订单</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- UTV -->
    <section id="utv">
      <div class="sectionHead">
        <h2>公用车辆（UTV）</h2>
        <small>先放 3-4 张占位图，后期你可替换为真实产品图</small>
      </div>

      <div class="grid utvGrid">
        <div class="card">
          <div class="cardMedia">（占位图）UTV Photo 1</div>
          <div class="cardBody">
            <div class="cardTitle">Utility Vehicle (UTV)</div>
            <p class="cardDesc">工地/园区/货运维护场景。支持 OEM 定制。</p>
          </div>
        </div>
        <div class="card">
          <div class="cardMedia">（占位图）UTV Photo 2</div>
          <div class="cardBody">
            <div class="cardTitle">Utility Vehicle (UTV)</div>
            <p class="cardDesc">可选货箱、加固车架、灯光等配置。</p>
          </div>
        </div>
        <div class="card">
          <div class="cardMedia">（占位图）UTV Photo 3</div>
          <div class="cardBody">
            <div class="cardTitle">Utility Vehicle (UTV)</div>
            <p class="cardDesc">适合批量采购与出口装柜支持。</p>
          </div>
        </div>
      </div>
    </section>

    <div class="footer">
      © 2026 Luyu Electric Vehicles. Email: carol@luyuevcart.com | WhatsApp: +86 132 9281 2529
    </div>
  </div>

  <!-- ---------------- Modal ---------------- -->
  <div class="modalOverlay" id="modal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalLeft">
        <div class="modalTitleRow">
          <h3 class="modalTitle" id="modalTitle">产品配置</h3>
          <button class="closeBtn" onclick="closeModal()">关闭</button>
        </div>

        <div class="panel">
          <h4>基准价格（参考价）</h4>
          <div class="big" id="basePriceText">来自 $****</div>
          <div class="muted">美元价格仅供参考。最终价格取决于配置与目的港。</div>
        </div>

        <div class="panel">
          <h4>当前总计（参考）</h4>
          <div class="big" id="totalPriceText">$0</div>
          <div class="muted">点击“运费/获取报价”将您的选择通过 WhatsApp 发送。</div>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <a class="btn primary" id="whBtn" target="_blank" rel="noopener"
             href="https://wa.me/8613292812529?text=Hello%20Luyu%2C%20I%20would%20like%20a%20quote.">
            运费/获取报价（WhatsApp）
          </a>
          <button class="btn" onclick="resetChoices()">重置</button>
        </div>
      </div>

      <!-- ✅ 右侧滚动区：ID 必须是 modalForm（用于拦截滚动事件） -->
      <div class="modalRight" id="modalForm">
        <!-- 动态插入表单 -->
        <div id="formMount"></div>

        <div class="modalBottom">
          <div class="totalLine">总计（参考值）：<span id="stickyTotal">$0</span></div>
          <div class="bottomBtns">
            <a class="btn primary" id="whBtn2" target="_blank" rel="noopener"
               href="https://wa.me/8613292812529?text=Hello%20Luyu%2C%20I%20would%20like%20a%20quote.">
              运费/获取报价
            </a>
            <button class="btn" onclick="closeModal()">关闭</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ---------------- Tabs scroll ---------------- */
    const tabs = document.querySelectorAll(".tab");
    tabs.forEach(t=>{
      t.addEventListener("click", ()=>{
        tabs.forEach(x=>x.classList.remove("active"));
        t.classList.add("active");
        const id = t.dataset.target;
        document.getElementById(id).scrollIntoView({behavior:"smooth", block:"start"});
      })
    });

    /* ---------------- Data (你后期改价格就改这里) ---------------- */
    const PRICE = {
      golf: {
        base: { A: 0, B: 0, C: 0, D: 0 }, // 你后期写基础价
        seats: [
          { id:"2", label:"2个座位", add:0 },
          { id:"4", label:"4个座位", add:0 },
          { id:"6", label:"6个座位", add:0 },
          { id:"8", label:"8个座位", add:0 },
        ],
        upgrades: [
          { key:"seat", title:"座椅", items:[
            { id:"seat_std", label:"标配座椅", add:0 },
            { id:"seat_lux", label:"升级版豪华座椅", add:88 }
          ]},
          { key:"dash", title:"中控", items:[
            { id:"dash_std", label:"标配中控", add:0 },
            { id:"dash_cp", label:"CarPlay + 后视摄像头", add:171 }
          ]},
          { key:"belt", title:"安全带", items:[
            { id:"belt_none", label:"标配无安全带", add:0 },
            { id:"belt_2p", label:"两点式安全带", add:35 },
            { id:"belt_3p", label:"三点式豪华安全带", add:40 },
          ]},
          { key:"tire", title:"轮胎", items:[
            { id:"tire_10", label:"标配10英寸公路胎", add:0 },
            { id:"tire_12", label:"升级版12英寸公路胎", add:88 },
            { id:"tire_14", label:"升级版14英寸越野胎", add:172 }
          ]},
          { key:"motor", title:"电机", items:[
            { id:"m35", label:"标配3.5千瓦电机", add:0 },
            { id:"m4", label:"升级版4千瓦电机", add:0 },   // 你后期填
            { id:"m5", label:"升级版5千瓦电机", add:0 }    // 你后期填
          ]},
          { key:"cover", title:"车衣", items:[
            { id:"cover_none", label:"标配无车衣", add:0 },
            { id:"cover_full", label:"全方位包裹型车衣", add:45 }
          ]},
          { key:"speaker", title:"扬声器", items:[
            { id:"spk_none", label:"标配无扬声器", add:0 },
            { id:"spk_2set", label:"升级2套扬声器", add:165 }
          ]}
        ],
        options: [
          { id:"wind", label:"可折叠前挡风玻璃", add:60 },
          { id:"front_bumper", label:"前保险杠", add:60 },
          { id:"front_basket", label:"前置物架", add:50 },
          { id:"bag_holder", label:"球包带", add:50 },
          { id:"bar_audio", label:"全车条形音响", add:100 },
          { id:"roof_light", label:"探照顶灯", add:25 },
          { id:"led_light", label:"全车LED彩灯", add:35 },
        ],
        freebies: [
          "标志设计",
          "免费定制车身颜色",
          "符合当地的充电器",
          "高尔夫球",
          "易损坏开关按钮配件"
        ]
      },

      bus: {
        base: { A: 0, B: 0 },
        seats: [
          { id:"8", label:"8座（标配）", add:0 },
          { id:"11", label:"11座", add:0 },
          { id:"14", label:"14座", add:0 },
          { id:"17", label:"17座", add:0 },
          { id:"20", label:"20座", add:0 },
          { id:"23", label:"23座", add:0 },
        ],
        upgrades: [
          { key:"motor", title:"电机", items:[
            { id:"m35", label:"标配3.5千瓦电机", add:0 },
            { id:"m4", label:"升级版4千瓦电机", add:0 },
            { id:"m5", label:"升级版5千瓦电机", add:0 }
          ]},
          { key:"body", title:"车身形式", items:[
            { id:"open", label:"敞篷", add:0 },
            { id:"closed", label:"全包裹", add:0 }
          ]},
          { key:"tire", title:"轮胎", items:[
            { id:"tire_10", label:"标配轮胎", add:0 },
            { id:"tire_12", label:"升级版12英寸公路胎", add:88 },
            { id:"tire_14", label:"升级版14英寸越野胎", add:172 }
          ]}
        ],
        freebies: ["（占位）后期补充免费赠送内容"]
      }
    };

    /* ---------------- State ---------------- */
    let currentType = "golf"; // golf / bus
    let currentPkg = "B";
    const state = {
      seat: null,
      upgrades: {},
      options: new Set()
    };

    /* ---------------- Modal open/close ---------------- */
    function openModal(type, pkg){
      currentType = type;
      currentPkg = pkg;
      resetChoices(false);

      // Title
      const titleMap = {
        golf: `电动高尔夫球车 - ${pkg} 套餐`,
        bus: `电动迷你巴士 - ${pkg} 套餐`
      };
      document.getElementById("modalTitle").textContent = titleMap[type] || "产品配置";

      // Base price
      const base = (PRICE[type].base[pkg] ?? 0);
      document.getElementById("basePriceText").textContent = base > 0 ? `来自 $${base}` : "来自 $****";

      // Build form
      buildForm(type);

      // Open modal
      document.getElementById("modal").classList.add("open");
      document.getElementById("modal").setAttribute("aria-hidden","false");

      // ✅ 关键：锁背景滚动 + 只允许弹窗内部滚动
      document.body.classList.add("modal-open");
      trapModalScroll();

      // First calc
      updateTotal();
    }

    function closeModal(){
      document.getElementById("modal").classList.remove("open");
      document.getElementById("modal").setAttribute("aria-hidden","true");

      // ✅ 关键：恢复背景滚动
      document.body.classList.remove("modal-open");
    }

    // 点击遮罩关闭
    document.getElementById("modal").addEventListener("click", (e)=>{
      if(e.target.id === "modal") closeModal();
    });

    /* ---------------- Build form ---------------- */
    function buildForm(type){
      const mount = document.getElementById("formMount");
      mount.innerHTML = "";

      // Seats group
      mount.appendChild(makeSingleChoiceGroup(
        "座位选择（选择一个）",
        PRICE[type].seats,
        (opt)=> { state.seat = opt; updateTotal(); },
        "seat"
      ));

      // Upgrades (radio groups)
      (PRICE[type].upgrades || []).forEach(g=>{
        mount.appendChild(makeSingleChoiceGroup(
          g.title,
          g.items,
          (opt)=> { state.upgrades[g.key] = opt; updateTotal(); },
          g.key
        ));
      });

      // Options (checkbox style using radio UI)
      if(type === "golf"){
        mount.appendChild(makeMultiChoiceGroup(
          "选配部分（可多选）",
          PRICE.golf.options,
          (id, on)=> {
            if(on) state.options.add(id);
            else state.options.delete(id);
            updateTotal();
          }
        ));

        // freebies
        mount.appendChild(makeListGroup("免费赠送（示例）", PRICE.golf.freebies));
      }else{
        mount.appendChild(makeListGroup("免费赠送（占位）", PRICE.bus.freebies));
      }
    }

    function makeSingleChoiceGroup(title, items, onPick, groupKey){
      const wrap = document.createElement("div");
      wrap.className = "group";
      wrap.innerHTML = `
        <div class="groupHead">
          <strong>${title}</strong>
          <span class="hint">单选</span>
        </div>
        <div class="options"></div>
      `;
      const optionsBox = wrap.querySelector(".options");

      items.forEach((it, idx)=>{
        const row = document.createElement("div");
        row.className = "opt";
        row.dataset.group = groupKey;
        row.dataset.id = it.id;
        row.dataset.add = it.add;

        row.innerHTML = `
          <div class="optLeft">
            <div class="imgPh">IMG</div>
            <div class="optText">
              <b>${it.label}</b>
              <span>（占位图，可后期替换）</span>
            </div>
          </div>
          <div class="optRight">
            <div class="priceTag">+${it.add} 美元</div>
            <span class="radio"></span>
          </div>
        `;

        row.addEventListener("click", ()=>{
          // clear group
          optionsBox.querySelectorAll(".opt").forEach(x=>{
            x.querySelector(".radio").classList.remove("on");
          });
          row.querySelector(".radio").classList.add("on");
          onPick({ id: it.id, label: it.label, add: it.add });
        });

        // default first option selected (seat: first; upgrade groups default first)
        if(idx === 0){
          setTimeout(()=>row.click(), 0);
        }

        optionsBox.appendChild(row);
      });

      return wrap;
    }

    function makeMultiChoiceGroup(title, items, onToggle){
      const wrap = document.createElement("div");
      wrap.className = "group";
      wrap.innerHTML = `
        <div class="groupHead">
          <strong>${title}</strong>
          <span class="hint">多选</span>
        </div>
        <div class="options"></div>
      `;
      const optionsBox = wrap.querySelector(".options");

      items.forEach((it)=>{
        const row = document.createElement("div");
        row.className = "opt";
        row.dataset.id = it.id;
        row.dataset.add = it.add;

        row.innerHTML = `
          <div class="optLeft">
            <div class="imgPh">IMG</div>
            <div class="optText">
              <b>${it.label}</b>
              <span>（占位图，可后期替换）</span>
            </div>
          </div>
          <div class="optRight">
            <div class="priceTag">+${it.add} 美元</div>
            <span class="radio"></span>
          </div>
        `;

        row.addEventListener("click", ()=>{
          const r = row.querySelector(".radio");
          const nowOn = !r.classList.contains("on");
          r.classList.toggle("on", nowOn);
          onToggle(it.id, nowOn);
        });

        optionsBox.appendChild(row);
      });

      return wrap;
    }

    function makeListGroup(title, items){
      const wrap = document.createElement("div");
      wrap.className = "group";
      wrap.innerHTML = `
        <div class="groupHead">
          <strong>${title}</strong>
          <span class="hint">文字会被 Google 抓取</span>
        </div>
        <div class="options" style="gap:8px;"></div>
      `;
      const box = wrap.querySelector(".options");
      items.forEach(t=>{
        const div = document.createElement("div");
        div.style.cssText = "padding:10px 12px;border:1px dashed #cfeedd;border-radius:14px;background:#fbfffd;color:#274a38;font-weight:700;";
        div.textContent = "• " + t;
        box.appendChild(div);
      });
      return wrap;
    }

    /* ---------------- Total / WhatsApp ---------------- */
    function updateTotal(){
      const type = currentType;
      const base = (PRICE[type].base[currentPkg] ?? 0);

      let total = base;

      if(state.seat) total += Number(state.seat.add || 0);

      // upgrades
      Object.values(state.upgrades).forEach(u=>{
        total += Number(u.add || 0);
      });

      // options
      if(type === "golf"){
        PRICE.golf.options.forEach(o=>{
          if(state.options.has(o.id)) total += Number(o.add || 0);
        });
      }

      // show
      const showText = `$${total}`;
      document.getElementById("totalPriceText").textContent = showText;
      document.getElementById("stickyTotal").textContent = showText;

      // build whatsapp message
      const msg = buildWhatsAppMessage(type, base, total);
      const url = "https://wa.me/8613292812529?text=" + encodeURIComponent(msg);
      document.getElementById("whBtn").href = url;
      document.getElementById("whBtn2").href = url;
    }

    function buildWhatsAppMessage(type, base, total){
      const title = (type === "golf")
        ? `EV Golf Cart - Package ${currentPkg}`
        : `Electric Mini Bus - Package ${currentPkg}`;

      const lines = [];
      lines.push(`Hello Luyu, I would like a quote.`);
      lines.push(`Product: ${title}`);
      lines.push(`Base price: ${base>0?("$"+base):"$****"} (reference)`);
      if(state.seat) lines.push(`Seat option: ${state.seat.label} (+$${state.seat.add})`);

      Object.entries(state.upgrades).forEach(([k,v])=>{
        if(v) lines.push(`Upgrade - ${k}: ${v.label} (+$${v.add})`);
      });

      if(type === "golf" && state.options.size){
        lines.push(`Optional items:`);
        PRICE.golf.options.forEach(o=>{
          if(state.options.has(o.id)) lines.push(`- ${o.label} (+$${o.add})`);
        });
      }

      lines.push(`Estimated total: $${total} (reference)`);
      lines.push(`Please advise shipping and final quotation.`);
      return lines.join("\n");
    }

    function resetChoices(recalc=true){
      state.seat = null;
      state.upgrades = {};
      state.options = new Set();
      if(recalc) updateTotal();
    }

    /* ---------------- ✅ Fix: Modal scroll should NOT scroll background ---------------- */
    function trapModalScroll(){
      const modal = document.getElementById("modal");
      const scrollBox = document.getElementById("modalForm"); // 右侧滚动区域

      // 防止重复绑定
      if(modal.dataset.trap === "1") return;
      modal.dataset.trap = "1";

      // 鼠标滚轮/触控板：只滚 modal，不传递到背景
      scrollBox.addEventListener("wheel", function(e){
        const delta = e.deltaY;
        const atTop = scrollBox.scrollTop <= 0;
        const atBottom = scrollBox.scrollTop + scrollBox.clientHeight >= scrollBox.scrollHeight - 1;

        if((atTop && delta < 0) || (atBottom && delta > 0)){
          e.preventDefault();
        }
      }, { passive:false });

      // 触摸滑动：防止背景滚动
      let startY = 0;
      scrollBox.addEventListener("touchstart", function(e){
        startY = e.touches[0].clientY;
      }, { passive:true });

      scrollBox.addEventListener("touchmove", function(e){
        const currentY = e.touches[0].clientY;
        const delta = startY - currentY;
        const atTop = scrollBox.scrollTop <= 0;
        const atBottom = scrollBox.scrollTop + scrollBox.clientHeight >= scrollBox.scrollHeight - 1;

        if((atTop && delta < 0) || (atBottom && delta > 0)){
          e.preventDefault();
        }
      }, { passive:false });
    }

    /* ---------------- Update hash scroll highlight ---------------- */
    // 如果你从首页点锚点进入
    if(location.hash){
      const id = location.hash.replace("#","");
      const el = document.getElementById(id);
      if(el) setTimeout(()=>el.scrollIntoView({behavior:"smooth"}), 100);
    }
  </script>
</body>
</html>
